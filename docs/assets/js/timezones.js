const tzs = [
 {
   "TimeZone": "Pacific/Midway",
   "UTC offset": "UTC-11:00",
   "name": "Midway Island, American Samoa"
 },
 {
   "TimeZone": "Pacific/Honolulu",
   "UTC offset": "UTC-10:00",
   "name": "Hawaii"
 },
 {
   "TimeZone": "America/Anchorage",
   "UTC offset": "UTC-08:00",
   "name": "Alaska"
 },
 {
   "TimeZone": "America/Tijuana",
   "UTC offset": "UTC-07:00",
   "name": "Baja California"
 },
 {
   "TimeZone": "America/Los_Angeles",
   "UTC offset": "UTC-07:00",
   "name": "Pacific Time US and Canada"
 },
 {
   "TimeZone": "America/Phoenix",
   "UTC offset": "UTC-07:00",
   "name": "Arizona"
 },
 {
   "TimeZone": "America/Chihuahua",
   "UTC offset": "UTC-06:00",
   "name": "Chihuahua, La Paz, Mazatlan"
 },
 {
   "TimeZone": "America/Denver",
   "UTC offset": "UTC-06:00",
   "name": "Mountain Time US and Canada"
 },
 {
   "TimeZone": "America/Belize",
   "UTC offset": "UTC-06:00",
   "name": "Central America"
 },
 {
   "TimeZone": "America/Chicago",
   "UTC offset": "UTC-05:00",
   "name": "Central Time US and Canada"
 },
 {
   "TimeZone": "America/Mexico_City",
   "UTC offset": "UTC-05:00",
   "name": "Guadalajara, Mexico City, Monterrey"
 },
 {
   "TimeZone": "America/Regina",
   "UTC offset": "UTC-06:00",
   "name": "Saskatchewan"
 },
 {
   "TimeZone": "America/Bogota",
   "UTC offset": "UTC-05:00",
   "name": "Bogota, Lima, Quito"
 },
 {
   "TimeZone": "America/Jamaica",
   "UTC offset": "UTC-05:00",
   "name": "Kingston, George Town"
 },
 {
   "TimeZone": "America/New_York",
   "UTC offset": "UTC-04:00",
   "name": "Eastern Time US and Canada"
 },
 {
   "TimeZone": "America/Indiana/Indianapolis",
   "UTC offset": "UTC-04:00",
   "name": "Indiana East"
 },
 {
   "TimeZone": "America/Caracas",
   "UTC offset": "UTC-04:30",
   "name": "Caracas"
 },
 {
   "TimeZone": "America/Asuncion",
   "UTC offset": "UTC-03:00",
   "name": "Asuncion"
 },
 {
   "TimeZone": "America/Halifax",
   "UTC offset": "UTC-03:00",
   "name": "Atlantic Time Canada"
 },
 {
   "TimeZone": "America/Cuiaba",
   "UTC offset": "UTC-04:00",
   "name": "Cuiaba"
 },
 {
   "TimeZone": "America/Manaus",
   "UTC offset": "UTC-04:00",
   "name": "Georgetown, La Paz, Manaus, San Juan"
 },
 {
   "TimeZone": "America/St_Johns",
   "UTC offset": "UTC-02:30",
   "name": "Newfoundland and Labrador"
 },
 {
   "TimeZone": "America/Sao_Paulo",
   "UTC offset": "UTC-03:00",
   "name": "Brasilia"
 },
 {
   "TimeZone": "America/Buenos_Aires",
   "UTC offset": "UTC-03:00",
   "name": "Buenos Aires"
 },
 {
   "TimeZone": "America/Cayenne",
   "UTC offset": "UTC-03:00",
   "name": "Cayenne, Fortaleza"
 },
 {
   "TimeZone": "America/Godthab",
   "UTC offset": "UTC-02:00",
   "name": "Greenland"
 },
 {
   "TimeZone": "America/Montevideo",
   "UTC offset": "UTC-03:00",
   "name": "Montevideo"
 },
 {
   "TimeZone": "America/Bahia",
   "UTC offset": "UTC-03:00",
   "name": "Salvador"
 },
 {
   "TimeZone": "America/Santiago",
   "UTC offset": "UTC-03:00",
   "name": "Santiago"
 },
 {
   "TimeZone": "America/Noronha",
   "UTC offset": "UTC-02:00",
   "name": "Mid-Atlantic"
 },
 {
   "TimeZone": "Atlantic/Azores",
   "UTC offset": "UTC+00:00",
   "name": "Azores"
 },
 {
   "TimeZone": "Atlantic/Cape_Verde",
   "UTC offset": "UTC-01:00",
   "name": "Cape Verde Islands"
 },
 {
   "TimeZone": "Europe/London",
   "UTC offset": "UTC+01:00",
   "name": "Dublin, Edinburgh, Lisbon, London"
 },
 {
   "TimeZone": "Africa/Casablanca",
   "UTC offset": "UTC+01:00",
   "name": "Casablanca"
 },
 {
   "TimeZone": "Africa/Monrovia",
   "UTC offset": "UTC+00:00",
   "name": "Monrovia, Reykjavik"
 },
 {
   "TimeZone": "Europe/Amsterdam",
   "UTC offset": "UTC+02:00",
   "name": "Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna"
 },
 {
   "TimeZone": "Europe/Belgrade",
   "UTC offset": "UTC+02:00",
   "name": "Belgrade, Bratislava, Budapest, Ljubljana, Prague"
 },
 {
   "TimeZone": "Europe/Brussels",
   "UTC offset": "UTC+02:00",
   "name": "Brussels, Copenhagen, Madrid, Paris"
 },
 {
   "TimeZone": "Europe/Warsaw",
   "UTC offset": "UTC+02:00",
   "name": "Sarajevo, Skopje, Warsaw, Zagreb"
 },
 {
   "TimeZone": "Africa/Algiers",
   "UTC offset": "UTC+01:00",
   "name": "West Central Africa"
 },
 {
   "TimeZone": "Africa/Windhoek",
   "UTC offset": "UTC+02:00",
   "name": "Windhoek"
 },
 {
   "TimeZone": "Europe/Athens",
   "UTC offset": "UTC+03:00",
   "name": "Athens, Bucharest"
 },
 {
   "TimeZone": "Asia/Beirut",
   "UTC offset": "UTC+03:00",
   "name": "Beirut"
 },
 {
   "TimeZone": "Africa/Cairo",
   "UTC offset": "UTC+02:00",
   "name": "Cairo"
 },
 {
   "TimeZone": "Asia/Damascus",
   "UTC offset": "UTC+03:00",
   "name": "Damascus"
 },
 {
   "TimeZone": "EET",
   "UTC offset": "UTC+03:00",
   "name": "Eastern Europe"
 },
 {
   "TimeZone": "Africa/Harare",
   "UTC offset": "UTC+02:00",
   "name": "Harare, Pretoria"
 },
 {
   "TimeZone": "Europe/Helsinki",
   "UTC offset": "UTC+03:00",
   "name": "Helsinki, Kiev, Riga, Sofia, Tallinn, Vilnius"
 },
 {
   "TimeZone": "Asia/Istanbul",
   "UTC offset": "UTC+03:00",
   "name": "Istanbul"
 },
 {
   "TimeZone": "Asia/Jerusalem",
   "UTC offset": "UTC+03:00",
   "name": "Jerusalem"
 },
 {
   "TimeZone": "Europe/Kaliningrad",
   "UTC offset": "UTC+02:00",
   "name": "Kaliningrad"
 },
 {
   "TimeZone": "Africa/Tripoli",
   "UTC offset": "UTC+02:00",
   "name": "Tripoli"
 },
 {
   "TimeZone": "Asia/Amman",
   "UTC offset": "UTC+03:00",
   "name": "Amman"
 },
 {
   "TimeZone": "Asia/Baghdad",
   "UTC offset": "UTC+03:00",
   "name": "Baghdad"
 },
 {
   "TimeZone": "Asia/Kuwait",
   "UTC offset": "UTC+03:00",
   "name": "Kuwait, Riyadh"
 },
 {
   "TimeZone": "Europe/Minsk",
   "UTC offset": "UTC+03:00",
   "name": "Minsk"
 },
 {
   "TimeZone": "Europe/Moscow",
   "UTC offset": "UTC+03:00",
   "name": "Moscow, St. Petersburg, Volgograd"
 },
 {
   "TimeZone": "Africa/Nairobi",
   "UTC offset": "UTC+03:00",
   "name": "Nairobi"
 },
 {
   "TimeZone": "Asia/Tehran",
   "UTC offset": "UTC+03:30",
   "name": "Tehran"
 },
 {
   "TimeZone": "Asia/Muscat",
   "UTC offset": "UTC+04:00",
   "name": "Abu Dhabi, Muscat"
 },
 {
   "TimeZone": "Asia/Baku",
   "UTC offset": "UTC+05:00",
   "name": "Baku"
 },
 {
   "TimeZone": "Europe/Samara",
   "UTC offset": "UTC+04:00",
   "name": "Izhevsk, Samara"
 },
 {
   "TimeZone": "Indian/Mauritius",
   "UTC offset": "UTC+04:00",
   "name": "Port Louis"
 },
 {
   "TimeZone": "Asia/Tbilisi",
   "UTC offset": "UTC+04:00",
   "name": "Tbilisi"
 },
 {
   "TimeZone": "Asia/Yerevan",
   "UTC offset": "UTC+04:00",
   "name": "Yerevan"
 },
 {
   "TimeZone": "Asia/Kabul",
   "UTC offset": "UTC+04:30",
   "name": "Kabul"
 },
 {
   "TimeZone": "Asia/Tashkent",
   "UTC offset": "UTC+05:00",
   "name": "Tashkent, Ashgabat"
 },
 {
   "TimeZone": "Asia/Yekaterinburg",
   "UTC offset": "UTC+05:00",
   "name": "Ekaterinburg"
 },
 {
   "TimeZone": "Asia/Karachi",
   "UTC offset": "UTC+05:00",
   "name": "Islamabad, Karachi"
 },
 {
   "TimeZone": "Asia/Kolkata",
   "UTC offset": "UTC+05:30",
   "name": "Chennai, Kolkata, Mumbai, New Delhi"
 },
 {
   "TimeZone": "Asia/Colombo",
   "UTC offset": "UTC+05:30",
   "name": "Sri Jayawardenepura"
 },
 {
   "TimeZone": "Asia/Katmandu",
   "UTC offset": "UTC+05:45",
   "name": "Kathmandu"
 },
 {
   "TimeZone": "Asia/Almaty",
   "UTC offset": "UTC+06:00",
   "name": "Astana"
 },
 {
   "TimeZone": "Asia/Dhaka",
   "UTC offset": "UTC+06:00",
   "name": "Dhaka"
 },
 {
   "TimeZone": "Asia/Novosibirsk",
   "UTC offset": "UTC+06:00",
   "name": "Novosibirsk"
 },
 {
   "TimeZone": "Asia/Rangoon",
   "UTC offset": "UTC+06:30",
   "name": "Yangon Rangoon"
 },
 {
   "TimeZone": "Asia/Bangkok",
   "UTC offset": "UTC+07:00",
   "name": "Bangkok, Hanoi, Jakarta"
 },
 {
   "TimeZone": "Asia/Krasnoyarsk",
   "UTC offset": "UTC+07:00",
   "name": "Krasnoyarsk"
 },
 {
   "TimeZone": "Asia/Chongqing",
   "UTC offset": "UTC+08:00",
   "name": "Beijing, Chongqing, Hong Kong SAR, Urumqi"
 },
 {
   "TimeZone": "Asia/Irkutsk",
   "UTC offset": "UTC+08:00",
   "name": "Irkutsk"
 },
 {
   "TimeZone": "Asia/Kuala_Lumpur",
   "UTC offset": "UTC+08:00",
   "name": "Kuala Lumpur, Singapore, Bali"
 },
 {
   "TimeZone": "Australia/Perth",
   "UTC offset": "UTC+08:00",
   "name": "Perth"
 },
 {
   "TimeZone": "Asia/Taipei",
   "UTC offset": "UTC+08:00",
   "name": "Taipei"
 },
 {
   "TimeZone": "Asia/Ulaanbaatar",
   "UTC offset": "UTC+08:00",
   "name": "Ulaanbaatar"
 },
 {
   "TimeZone": "Asia/Tokyo",
   "UTC offset": "UTC+09:00",
   "name": "Osaka, Sapporo, Tokyo"
 },
 {
   "TimeZone": "Asia/Seoul",
   "UTC offset": "UTC+09:00",
   "name": "Seoul"
 },
 {
   "TimeZone": "Asia/Yakutsk",
   "UTC offset": "UTC+09:00",
   "name": "Yakutsk"
 },
 {
   "TimeZone": "Australia/Adelaide",
   "UTC offset": "UTC+10:30",
   "name": "Adelaide"
 },
 {
   "TimeZone": "Australia/Darwin",
   "UTC offset": "UTC+09:30",
   "name": "Darwin"
 },
 {
   "TimeZone": "Australia/Brisbane",
   "UTC offset": "UTC+10:00",
   "name": "Brisbane"
 },
 {
   "TimeZone": "Australia/Canberra",
   "UTC offset": "UTC+11:00",
   "name": "Canberra, Melbourne, Sydney"
 },
 {
   "TimeZone": "Pacific/Guam",
   "UTC offset": "UTC+10:00",
   "name": "Guam, Port Moresby"
 },
 {
   "TimeZone": "Australia/Hobart",
   "UTC offset": "UTC+11:00",
   "name": "Hobart"
 },
 {
   "TimeZone": "Asia/Magadan",
   "UTC offset": "UTC+10:00",
   "name": "Magadan"
 },
 {
   "TimeZone": "Asia/Vladivostok",
   "UTC offset": "UTC+10:00",
   "name": "Vladivostok, Magadan"
 },
 {
   "TimeZone": "Asia/Srednekolymsk",
   "UTC offset": "UTC+11:00",
   "name": "Chokirdakh"
 },
 {
   "TimeZone": "Pacific/Guadalcanal",
   "UTC offset": "UTC+11:00",
   "name": "Solomon Islands, New Caledonia"
 },
 {
   "TimeZone": "Asia/Anadyr",
   "UTC offset": "UTC+12:00",
   "name": "Anadyr, Petropavlovsk-Kamchatsky"
 },
 {
   "TimeZone": "Pacific/Auckland",
   "UTC offset": "UTC+13:00",
   "name": "Auckland, Wellington"
 },
 {
   "TimeZone": "Pacific/Fiji",
   "UTC offset": "UTC+12:00",
   "name": "Fiji Islands, Kamchatka, Marshall Islands"
 },
 {
   "TimeZone": "Pacific/Tongatapu",
   "UTC offset": "UTC+13:00",
   "name": "Nuku'alofa"
 },
 {
   "TimeZone": "Pacific/Apia",
   "UTC offset": "UTC+14:00",
   "name": "Samoa"
 }
]

function refreshTimezones(mode) {
    const selects = document.querySelectorAll(".tzs");
    selects.forEach(select => {
        select.innerHTML = ""; // Clear existing options
        const defaultSelect = document.createElement("option");
        defaultSelect.value = "";
        defaultSelect.textContent = "Select a timezone";
        select.appendChild(defaultSelect);

        if (mode === "utc") {
            tzs.forEach(tz => {
                const option = document.createElement("option");
                option.value = tz["UTC offset"];
                option.textContent = `(${tz["UTC offset"]}) - (${tz.TimeZone}) - ${tz.name} `;
                select.appendChild(option);
            });
        } else if (mode === "name") {
            tzsplit = []
            tzs.forEach(tz => {
                names = tz.name.split(",");
                names.forEach(name => {
                    name = name.trim();
                    if (!tzsplit.some(tzItem => tzItem.name === name)) {
                        tzsplit.push({
                            "UTC offset": tz["UTC offset"],
                            "TimeZone": tz.TimeZone,
                            "name": name
                        });
                    }
                });
            });
            tzsplit.sort((a, b) => a.name.localeCompare(b.name)).forEach(tz => {
                const option = document.createElement("option");
                option.value = tz["UTC offset"];
                option.textContent = `${tz.name} (${tz.TimeZone}) - ${tz["UTC offset"]}`;
                select.appendChild(option);
            });
        }
        
    });
}

function reorder(){
    const mode = document.querySelector('input[name="ordering"]:checked').value;

    if(mode === "utc"){
        refreshTimezones();
    }
    else {
        refreshTimezones("name");
    }

    document.querySelectorAll(".result").forEach(result => {
        result.innerHTML = ""; // Clear existing results
    });
}

function refresh() {
    refreshOne("targetTimezone1");
    refreshOne("targetTimezone2");
    refreshOne("targetTimezone3");
    refreshOne("targetTimezone4");
    refreshOne("targetTimezone5");
    refreshOne("targetTimezone6");
    refreshOne("targetTimezone7");
}

function refreshOne(id) {
    const sourceDateTime = document.getElementById("sourceDateTime").value;
    const sourceTimezone = document.getElementById("sourceTimezone").value;
    const targetTimezone = document.getElementById(id).value;

    if (sourceDateTime && sourceTimezone && targetTimezone) {
        const date = new Date(sourceDateTime);
        const match = sourceTimezone.match(/^UTC([+-])(\d{2}):(\d{2})$/);

        let utcOffset = 0;
        if (match) {
            const sign = match[1] === "+" ? 1 : -1;
            const hours = parseInt(match[2], 10);
            const minutes = parseInt(match[3], 10);
            utcOffset = sign * (hours * 60 + minutes);
        }

        utcDate = new Date(date.getTime() - utcOffset * 60000);

        let utcTarget = document.getElementById(id).value;
        const targetMatch = utcTarget.match(/^UTC([+-])(\d{2}):(\d{2})$/);
        if (targetMatch) {
            const targetSign = targetMatch[1] === "+" ? 1 : -1;
            const targetHours = parseInt(targetMatch[2], 10);
            const targetMinutes = parseInt(targetMatch[3], 10);
            targetOffset = targetSign * (targetHours * 60 + targetMinutes);
        }
        utcDate = new Date(utcDate.getTime() + targetOffset * 60000);

        delta =  targetOffset - utcOffset;
        ahead = delta > 0 ? true : false;

        absDelta = Math.abs(delta);

        result = utcDate.toLocaleString(undefined, {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            hour12: false,
        });

        const isDifferentDay = date.getDate() !== utcDate.getDate() ||
                       date.getMonth() !== utcDate.getMonth() ||
                       date.getFullYear() !== utcDate.getFullYear();

        let endTime = null;
        const duration = document.getElementById("duration").value;
        if (duration) {
            const durationParts = duration.split(":");
            const durationHours = parseInt(durationParts[0], 10);
            const durationMinutes = parseInt(durationParts[1], 10);
            const durationTotalMinutes = durationHours * 60 + durationMinutes;
            endTime = new Date(utcDate.getTime() + durationTotalMinutes * 60000).toLocaleString(undefined, {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false,
            });
        }

        document.getElementById(id.replace("Timezone", "Result")).innerHTML = `${result} <br> Delta: ${absDelta/60} hours ${ahead ? "ahead" : "behind" } ${isDifferentDay ? '<br><span style="color:red; font-weight:bold;">Different day!</span>' : ''} ${endTime ? `<br>End time: ${endTime}` : ''}`;
    }

}


document.addEventListener("DOMContentLoaded", () => {
    refreshTimezones("name");
});
